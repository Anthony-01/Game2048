var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o["throw"](e))}catch(t){i(t)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(o){n=[6,o],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},base;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._actionList=[],t.m_ifComplete=!1,t._adjustComponent=[],t._scaleComponent=[],t.addEventListener(eui.UIEvent.COMPLETE,t.onComplete,t),t}return __extends(t,e),t.prototype.onComplete=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.adjustComponent(),this.m_ifComplete=!0,this.initBtn(),this.init(),this.beginComponentAction()},t.prototype.beginComponentAction=function(){var e=this._actionList[0];null!=e&&(e(),this._actionList.splice(0,1),this.beginComponentAction())},t.prototype.initBtn=function(){},t.prototype.init=function(){},t.prototype.adjustComponent=function(){},t.prototype.pushAction=function(e){this.m_ifComplete?e():this._actionList.push(e)},t}(eui.Component);e.BaseComponent=t,__reflect(t.prototype,"base.BaseComponent")}(base||(base={}));var base;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.name=t,n}return __extends(t,e),t.prototype.dealloc=function(){this.removeChildren()},t}(e.BaseComponent);e.BaseScene=t,__reflect(t.prototype,"base.BaseScene")}(base||(base={}));var frame;!function(e){var t=function(){function e(e){this._dispatcher=new egret.EventDispatcher,this.addEventListener()}return e.prototype.getDispatcher=function(){return this._dispatcher},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.addEventListener=function(){this._dispatcher.addEventListener(customEvent.CustomEvent.EVENT_CONNECT_COMPLETE,this.onConnectComplete,this),this._dispatcher.addEventListener(customEvent.CustomEvent.EVENT_MESSAGE_DISPATCH,this.onGameMessage,this)},e.prototype.removeEventListener=function(){this._dispatcher.removeEventListener(customEvent.CustomEvent.EVENT_CONNECT_COMPLETE,this.onConnectComplete,this),this._dispatcher.removeEventListener(customEvent.CustomEvent.EVENT_MESSAGE_DISPATCH,this.onGameMessage,this)},e.prototype.onConnectComplete=function(e){console.log("连接成功")},e.prototype.onGameMessage=function(e){},e.prototype.sendPing=function(e){},e}();e.BaseFrame=t,__reflect(t.prototype,"frame.BaseFrame")}(frame||(frame={}));var model;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.onInitEngine(),manager.TimerCtrl.getInstance().createTimer(t,1e3,0,t.onClockUpdateEvent,"clock"),manager.TimerCtrl.getInstance().createTimer(t,1e3/60,0,t.onUpdate,"update"),t}return __extends(t,e),t.prototype.onInitEngine=function(e){e&&this.setGameView(e)},t.prototype.onResetEngine=function(){},t.prototype.setGameView=function(e){this._gameView=e},t.prototype.setGameFrame=function(e){this._gameFrame=e},t.prototype.onClockUpdateEvent=function(){},t.prototype.onUpdate=function(){},t}(eui.UILayer);e.GameModel=t,__reflect(t.prototype,"model.GameModel")}(model||(model={}));var algorithm;!function(e){var t=function(){function e(){}return e.prototype.insert=function(e,t){var o;return null==e?(o=new n,o.left=o.right=null,o.value=t,o):(e.value>t&&(e.left=this.insert(e.left,t)),e.right=this.insert(e.right,t),e)},e.prototype.find=function(e,t){return null==e?!1:e.value==t?!0:t<e.value?this.find(e.left,t):this.find(e.right,t)},e.prototype.remove=function(e,t){if(null==e)return null;if(t<e.value&&this.remove(e.left,t),t>e.value&&this.remove(e.right,t),null==e.left)return e.value=e.right.value,e.left=e.right.left,e.right=e.right.right,e;if(null==e.left.right)return e.value=e.left.value,e.left=e.left.left,e.right=e.left.right,e;for(var n=e.left.right;null!=n.right;n=n.right);return e.value=n.value,e.left=n.left,e.right=n.right,n},e}();e.BinarySearchTree=t,__reflect(t.prototype,"algorithm.BinarySearchTree");var n=function(){function e(){}return e}();e.SearchNode=n,__reflect(n.prototype,"algorithm.SearchNode")}(algorithm||(algorithm={}));var manager;!function(e){var t=function(){function t(){}return t.getInstance=function(){return null==this.m_Instance&&(this.m_Instance=new t,this.m_Instance.onInit()),this.m_Instance},t.prototype.onInit=function(){e.TimerCtrl.getInstance().onInit()},t.prototype.start=function(){return"MainScene"==this.m_CurrentScene.name?void console.log("当前即为游戏主界面"):void 0},t.prototype.setCurrentScene=function(e){this.m_CurrentScene=null,this.m_CurrentScene=e,this.m_MainStage.removeChildren(),this.m_MainStage.addChild(e)},t.prototype.getCurrentScene=function(){return this.m_CurrentScene},t.prototype.isGameScene=function(){return"MainScene"==this.m_CurrentScene.name?!0:!1},t.prototype.replaceScene=function(e,t){var n=this,o=this.m_CurrentScene;if(this.m_CurrentScene==e&&utils.colorConsole("替换错误"),this.m_CurrentScene=null,this.m_CurrentScene=e,t&&o){e.alpha=0,this.m_MainStage.addChild(e);var r=egret.Tween.get(e),i=egret.Tween.get(o),a=[];return a.push(new Promise(function(e,t){i.to({alpha:0},1e3,egret.Ease.backOut).call(function(){e()})})),a.push(new Promise(function(e,t){r.to({alpha:1},1e3,egret.Ease.backIn).call(function(){e()})})),Promise.all(a).then(function(){return n.m_MainStage.removeChild(o),Promise.resolve()})}return this.m_MainStage.addChild(e),this.m_MainStage.removeChild(o),Promise.resolve()},t}();e.FrameManager=t,__reflect(t.prototype,"manager.FrameManager")}(manager||(manager={}));var game;!function(e){var t;!function(e){e[e.start=0]="start",e[e.add=1]="add",e[e.move=2]="move",e[e.over=3]="over"}(t=e.EActionType||(e.EActionType={}));var n;!function(e){e[e.up=0]="up",e[e.right=1]="right",e[e.down=2]="down",e[e.left=3]="left"}(n=e.EMoveDirection||(e.EMoveDirection={}));var o=function(){function e(e,t,n){this.mapList={},this._component=e,this._callBack=t,this._params=n}return e.prototype.execute=function(){var t=this;this._callBack.apply(this._component,this._params).then(function(){t.trigger(e.EVENT_COMPLETE)})},e.prototype.undo=function(){},e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!this.mapList[e])return!1;for(var o=this.mapList[e],r=0,i=void 0,a=void 0;r<o.length;r++)i=o[r].fn,a=o[r].obj,i.apply.apply(i,[a].concat(t))},e.prototype.addListener=function(e,t,n){this.mapList[e]||(this.mapList[e]=[]);var o={fn:t,obj:n},r=this.mapList[e].indexOf(o);return-1!=r?console.error("重复监听"):void this.mapList[e].push(o)},e.prototype.removeListener=function(e,t,n){var o,r={fn:t,obj:n};return this.mapList[e]&&this.mapList[e].forEach(function(e,t){e.fn==r.fn&&e.obj==r.obj&&(o=t)}),void 0===o?console.error("移除不存在的监听"):void this.mapList[e].splice(o,1)},e.EVENT_COMPLETE="eventComplete",e}();e.ActionCommand=o,__reflect(o.prototype,"game.ActionCommand",["game.IActionCommand"])}(game||(game={}));var game;!function(e){function t(){var t=new e.MoveProcessor;o={},o[e.EActionType.start]=t,n=o;var o}var n,o=function(){function e(){n||t(),this._processorMap=n}return e.prototype.assertAction=function(){},e.prototype.applyAction=function(e,t){var n=e.actionType,o=this._processorMap[n];o.assertAction(e,t)?o.applyAction(e,t):console.error("动作验证失败",e.actionType)},e.prototype.cancelAction=function(){},e}();e.ActionExecutor=o,__reflect(o.prototype,"game.ActionExecutor",["game.IActionExecutor"])}(game||(game={}));var game;!function(e){var t;!function(e){e[e.ready=0]="ready",e[e.on=1]="on",e[e.over=2]="over"}(t=e.EGameStatus||(e.EGameStatus={}));var n;!function(e){e[e.ready=0]="ready",e[e.on=1]="on"}(n=e.EActionStatus||(e.EActionStatus={}));var o=function(o){function r(){var n=o.call(this)||this;return n._gameStatus=t.ready,n._actionList=[],n.m_commandStack=[],n._actionMaster=new e.ActionExecutor,n._actionMaster.host=n,n._gameLogic=new e.GameLogic,n._scoreMaster=new e.ScoreMaster,n}return __extends(r,o),Object.defineProperty(r.prototype,"status",{get:function(){return this._actionStatus},enumerable:!0,configurable:!0}),r.prototype.startGame=function(){if(!this.gameView)return console.error("开始游戏失败,未设置游戏视图");this._gameStatus=t.on,this._actionStatus=n.ready;var o=JSON.parse(localStorage.getItem("configOf2048")),r=this._scoreMaster.Score,i={grid:o,score:r};console.log("获取配置",o),this.m_grid=new e.Grid(o),this.gameView.startFrom(i)},r.prototype.onGameMessage=function(e){this._actionList.push(e),this._actionStatus==n.ready&&this.applyAction(this._actionList[0])},r.prototype.move=function(e){var t=e.data;console.log(t),this._actionList.push(t)},r.prototype.assertAction=function(e){return this._actionStatus==n.ready},r.prototype.applyAction=function(t){var o=this,r=this;if(this._actionStatus==n.on)return console.warn("正在执行动作",this._currentCommand);this._actionStatus=n.on,t.addListener(e.ActionCommand.EVENT_COMPLETE,this.onComplete,this),this._currentCommand=t;var i;switch(t.actionType){case e.EActionType.start:i=this.subStartGame;break;case e.EActionType.add:i=this.subAddTile;break;case e.EActionType.move:i=this.subMoveTile;break;case e.EActionType.over:i=this.subGameOver}return i?void i.call(this,t.actionData).then(function(){t.trigger(e.ActionCommand.EVENT_COMPLETE),o.m_commandStack.push(t),localStorage.setItem("configOf2048",JSON.stringify(r.m_grid.getGrid()))})["catch"](function(n){console.log(n),t.trigger(e.ActionCommand.EVENT_COMPLETE)}):void console.warn("未注册的游戏动作",t)},r.prototype.onComplete=function(){var t=this._currentCommand;t.removeListener(e.ActionCommand.EVENT_COMPLETE,this.onComplete,this),this._actionStatus=n.ready,this._currentCommand=null,this.dispatchEventWith(customEvent.ModelEvent.EVENT_ACTION_COMPLETE)},r.prototype.subStartGame=function(){var e=this.m_grid.addRandomTile();return this.gameView.startGame(e)},r.prototype.subAddTile=function(){var e=this.m_grid.addRandomTile();return this.gameView.addTile(e)},r.prototype.subMoveTile=function(e){var t=this,n=this,o=this.m_grid.getGrid(),r=this._gameLogic.getBoard(e,o),i=[],a=this._scoreMaster.caculateAdd(r);return i.push(this.gameView.addScore(a)),i.push(this.gameView.moveTiles(r).then(function(e){return new Promise(function(e,o){r.forEach(function(e){n.m_grid.changeTile(e)}),t.m_grid.checkGameOver()&&t.gameView.overGame(),e()})})),Promise.all(i)},r.prototype.subGameOver=function(){},r.prototype.setView=function(e){this.gameView=e},r.prototype.removeView=function(){},r.prototype.updateView=function(){if(this.gameView.updateView(),this._actionStatus==n.ready){var e=this._actionList[0];e&&this.applyAction(e)}},r.prototype.onUpdate=function(){this.updateView()},r.prototype.reset=function(){},r}(egret.DisplayObject);e.GameHost=o,__reflect(o.prototype,"game.GameHost",["game.IGameHost"])}(game||(game={}));var game;!function(e){var t=function(){function e(){this._currentScore=0;var e=parseInt(localStorage.getItem("score"));e?this._currentScore=e:this._currentScore=0}return e.prototype.caculateAdd=function(e){var t=0;return e.forEach(function(e){e.merge&&(t+=Math.pow(2,e.value))}),this._currentScore+=t,localStorage.setItem("score",this._currentScore+""),t},Object.defineProperty(e.prototype,"Score",{get:function(){return this._currentScore},enumerable:!0,configurable:!0}),e}();e.ScoreMaster=t,__reflect(t.prototype,"game.ScoreMaster")}(game||(game={}));var game;!function(e){var t=function(){function e(){}return e.prototype.assertAction=function(e,t){},e.prototype.applyAction=function(e,t){t.m_grid},e}();e.MoveProcessor=t,__reflect(t.prototype,"game.MoveProcessor",["game.IActionProcessor"])}(game||(game={}));var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?o(r):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var customEvent;!function(e){var t=function(e){function t(t,n,o,r){return e.call(this,t,n,o,r)||this}return __extends(t,e),t.EVENT_CONNECT_COMPLETE="connectComplete",t.EVENT_MESSAGE_DISPATCH="messageDispatch",t.EVENT_CONNECT_FAIlURE="connectFailure",t}(egret.Event);e.CustomEvent=t,__reflect(t.prototype,"customEvent.CustomEvent")}(customEvent||(customEvent={}));var customEvent;!function(e){var t=function(e){function t(t,n,o,r){return e.call(this,t,n,o,r)||this}return __extends(t,e),t.EVENT_ACTION_COMPLETE="actionComplete",t}(egret.Event);e.ModelEvent=t,__reflect(t.prototype,"customEvent.ModelEvent")}(customEvent||(customEvent={}));var customEvent;!function(e){var t=function(e){function t(t,n,o,r){return e.call(this,t,n,o,r)||this}return __extends(t,e),t.EVENT_RETURN_EVENT="returnEvent",t.EVENT_GAME_START="gameStart",t.EVENT_MOVE_EVENT="moveEvent",t.EVENT_OVER_EVENT="overEvent",t}(egret.Event);e.ViewEvent=t,__reflect(t.prototype,"customEvent.ViewEvent")}(customEvent||(customEvent={}));var factory;!function(e){var t=function(){function e(){}return e.prototype.createTile=function(e,t,n){return new game.Tile(e,t,n)},e}();e.TileFactory=t,__reflect(t.prototype,"factory.TileFactory",["factory.tileFactory"])}(factory||(factory={}));var BinarySearchTree=algorithm.BinarySearchTree,Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),manager.FrameManager.getInstance().m_MainStage=this.stage,this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){this.startView=new game.StartScene,this.startView.addEventListener(customEvent.ViewEvent.EVENT_GAME_START,this.startGame,this),manager.FrameManager.getInstance().setCurrentScene(this.startView)},t.prototype.getGrid=function(){for(var e=[],t=0;5>t;t++){for(var n=[],o=0;5>o;o++)n.push(null);e.push(n)}return e},t.prototype.startGame=function(){this.gameView=new game.GameView,game.GameEngine.getIns()._gameView=this.gameView,this.gameView.addEventListener(customEvent.ViewEvent.EVENT_RETURN_EVENT,this["return"],this),manager.FrameManager.getInstance().replaceScene(this.gameView,!0).then(function(){game.GameEngine.getIns().runGame()})},t.prototype["return"]=function(){var e=this;manager.FrameManager.getInstance().replaceScene(this.startView,!0).then(function(){e.gameView.dealloc(),e.gameView=null})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var frame;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.BaseFrame);e.GameFrame=t,__reflect(t.prototype,"frame.GameFrame")}(frame||(frame={}));var frame;!function(e){var t=function(){function e(){console.log("测试框架")}return e}();e.TestFrame=t,__reflect(t.prototype,"frame.TestFrame")}(frame||(frame={}));var game;!function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._actionList=[],e._actionQueqe=[],e}return __extends(n,t),n.getIns=function(){return null==this.m_Instance&&(this.m_Instance=new n,this.m_Instance.init()),this.m_Instance},n.prototype.init=function(){this._gameHost=new e.GameHost},n.prototype.runGame=function(){this._gameView?this._gameHost.setView(this._gameView):console.warn("未初始化游戏视图"),this._gameHost.addEventListener(customEvent.ModelEvent.EVENT_ACTION_COMPLETE,this.actionComplete,this),this._gameView.addEventListener(customEvent.ViewEvent.EVENT_MOVE_EVENT,this.move,this),this._gameView.addEventListener(customEvent.ViewEvent.EVENT_OVER_EVENT,this.overGame,this),this._gameHost.startGame();var t=new e.ActionCommand(this,function(){return new Promise(function(e){console.log("游戏开始")})});t.actionType=e.EActionType.start,this._gameHost.applyAction(t),manager.TimerCtrl.getInstance().createTimer(this,1e3/60,0,this.onUpdate,"gameUpdate")},n.prototype.actionComplete=function(){var t=this._actionQueqe[0];t&&this._gameHost.status==e.EActionStatus.ready&&(this._gameHost.applyAction(t),this._actionQueqe.shift())},n.prototype.move=function(t){var n=t.data;this._actionQueqe.push(n);var o=new e.ActionCommand(this,function(){return new Promise(function(e,t){console.log("增加棋子的命令")})});o.actionType=e.EActionType.add,this._actionQueqe.push(o),this.actionComplete()},n.prototype.overGame=function(){},n.prototype.onResetEngine=function(){this._gameHost.removeEventListener(customEvent.ModelEvent.EVENT_ACTION_COMPLETE,this.actionComplete,this),this._gameView.removeEventListener(customEvent.ViewEvent.EVENT_MOVE_EVENT,this.move,this),this._gameView.removeEventListener(customEvent.ViewEvent.EVENT_OVER_EVENT,this.overGame,this),manager.TimerCtrl.getInstance().killTimer(this,"gameUpdate")},n}(model.GameModel);e.GameEngine=t,__reflect(t.prototype,"game.GameEngine")}(game||(game={}));var manager;!function(e){var t=function(){function t(){}return t.prototype.init=function(){this.m_storageManager=new e.StorageManager,this.setup()},t.prototype.setup=function(){},t}();e.GameManager=t,__reflect(t.prototype,"manager.GameManager")}(manager||(manager={}));var manager;!function(e){var t=function(){function e(){}return e}();e.SoundManager=t,__reflect(t.prototype,"manager.SoundManager")}(manager||(manager={}));var manager;!function(e){var t=function(){function e(){this.storage=window.localStorage,this.bestScoreKey="bestScore",this.gameStateKey="gameState"}return e.prototype.setGameState=function(e){this.storage.setItem(this.gameStateKey,JSON.stringify(e))},e.prototype.getGameStatus=function(){var e=this.storage.getItem(this.gameStateKey);return e?JSON.parse(e):null},e.prototype.getBestScore=function(){return this.storage.getItem(this.bestScoreKey)||0},e}();e.StorageManager=t,__reflect(t.prototype,"manager.StorageManager")}(manager||(manager={}));var manager;!function(e){var t=function(){function e(){this._timerQueue=[]}return e.getInstance=function(){return null==this.m_Instance&&(this.m_Instance=new e,this.m_Instance.onInit()),this.m_Instance},e.prototype.onInit=function(){this.clean()},e.prototype.createTimer=function(e,t,n,o,r){void 0===t&&(t=1e3/60);for(var i=0;i<this._timerQueue.length;i++){var a=this._timerQueue[i];if(a.key==r)return console.log("队列中存在相同key的定时器"),!1}var s=new egret.Timer(t,n);s.addEventListener(egret.TimerEvent.TIMER,o,e),s.start();var c={key:r,timer:s,callBack:o,target:e};return this._timerQueue.push(c),!0},e.prototype.killTimer=function(e,t){for(var n=0;n<this._timerQueue.length;n++){var o=this._timerQueue[n];if(o.key==t){if(o.target!=e)return console.log("定时器对象错误"),!1;var r=o.timer,i=o.callBack;r.removeEventListener(egret.TimerEvent.TIMER,i,e),r.stop(),r=null,this._timerQueue.splice(n,1);break}}return!0},e.prototype.clean=function(){for(var e=0;e<this._timerQueue.length;e++){var t=this._timerQueue[e].callBack,n=this._timerQueue[e].target,o=this._timerQueue[e].timer;o.removeEventListener(egret.TimerEvent.TIMER,t,n),o.stop(),o=null}this._timerQueue=[]},e}();e.TimerCtrl=t,__reflect(t.prototype,"manager.TimerCtrl")}(manager||(manager={}));var manager;!function(e){var t;!function(e){e[e.startView=0]="startView",e[e.gameView=1]="gameView",e[e.overView=2]="overView"}(t=e.EViewName||(e.EViewName={}));var n=function(){function e(){}return e.getIns=function(){return this._ins||(this._ins=new e,this._ins.init()),this._ins},e.prototype.init=function(){this.setView(new egret.DisplayObjectContainer,t.startView)},e.prototype.setStage=function(){},e.prototype.setView=function(e,t){},e}();e.ViewManager=n,__reflect(n.prototype,"manager.ViewManager",["manager.IViewManager"])}(manager||(manager={}));var game;!function(e){e.C_BOARD_MAX=5;var t;!function(e){e[e.negative=-1]="negative",e[e.zero=0]="zero",e[e.positive=1]="positive"}(t||(t={}));var n={0:{x:-1,y:0},1:{x:0,y:1},2:{x:1,y:0},3:{x:0,y:-1}},o={x:[0,1,2,3,4],y:[0,1,2,3,4]},r=function(){function t(){}return t.prototype.getBoard=function(e,t){var n=this,o=[],r=this.toBoard(t);if(r){var i=this.getVector(e),a=this.getBuild(i);return a.x.forEach(function(e){a.y.forEach(function(t){var a,s=r[e][t];if(s.value){a=n.getNext(e,t,r,i);var c=void 0;if(s.value==a.value&&0==a.mergedFrom.length)a.value+=1,a.mergedFrom.push(s),r[e][t]=n.getInitTile(e,t,null),c={origin:{x:s.x,y:s.y},goal:{x:a.x,y:a.y},merge:!0,add:!0,value:s.value};else{var u={x:a.value?a.x-i.x:a.x,y:a.value?a.y-i.y:a.y};(u.x!=s.x||u.y!=s.y)&&(r[e][t]=n.getInitTile(e,t,null),r[u.x][u.y]=s,c={origin:{x:s.x,y:s.y},goal:u,merge:!1,add:!1},s.x=u.x,s.y=u.y)}c&&o.push(c)}})}),o}},t.prototype.getNext=function(e,t,n,o){for(var r=1;this.withinBounds(e+r*o.x,t+r*o.y);r++)if(null!=n[e+r*o.x][t+r*o.y].value)return n[e+r*o.x][t+r*o.y];return this.getLimit(e,t,n,o)},t.prototype.getLimit=function(t,n,o,r){var i=0==r.x?t:1==r.x?e.C_BOARD_MAX-1:0,a=0==r.y?n:1==r.y?e.C_BOARD_MAX-1:0;return{x:i,y:a,value:null}},t.prototype.withinBounds=function(t,n){var o=t>=0&&t<e.SIZE&&n>=0&&n<e.SIZE;return o},t.prototype.getVector=function(e){return n[e]},t.prototype.getBuild=function(e){var t={x:o.x.concat(),y:o.y.concat()};return 1===e.x&&t.x.reverse(),1===e.y&&t.y.reverse(),t},t.prototype.getVancancyPosition=function(e){var t=[];if(!this.checkBoard(e))return console.log(""),[];var n=function(n){e[n].forEach(function(e,o){if(0==e){var r={x:parseInt(n),y:o,value:0};t.push(r)}})};for(var o in e)n(o);return t},t.prototype.toBoard=function(e){var t=[];if(this.checkBoard(e)){var n=function(n){var o=[];e[n].forEach(function(e,t){if(0!==e){var r={x:parseInt(n),y:t,value:e,merge:!1,mergedFrom:[]};o[t]=r}}),t.push(o)};for(var o in e)n(o);return t}return console.error("棋盘数据错误:",e),null},t.prototype.getInitTile=function(e,t,n){return{x:e,y:t,value:n,merge:!1,mergedFrom:[]}},t.prototype.checkBoard=function(t){if(t.length!=e.C_BOARD_MAX)return console.error("棋盘数据错误:",t),!1;for(var n=0,o=t;n<o.length;n++){var r=o[n];if(r.length!=e.C_BOARD_MAX)return console.error("棋盘数据错误:",t),!1}return!0},t}();e.GameLogic=r,__reflect(r.prototype,"game.GameLogic")}(game||(game={}));var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var myComponent;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.anchorOffsetX=143,t.anchorOffsetY=76,t}return __extends(t,e),t.prototype.init=function(){console.log("MyButton")},t.prototype.initBtn=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBegin,this)},t.prototype.onBegin=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:console.log("touchBegin"),this.currentState="down";break;case egret.TouchEvent.TOUCH_END:console.log("touchEnd"),this.currentState="up";break;case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:console.log("touchOUT"),this.currentState="up";break;case egret.TouchEvent.TOUCH_CANCEL:console.log("touchCancel"),this.currentState="up";break;case egret.TouchEvent.TOUCH_TAP:console.log("touchTap")}},t}(base.BaseComponent);e.MyButton=t,__reflect(t.prototype,"myComponent.MyButton")}(myComponent||(myComponent={}));var utils;!function(e){function t(e,t,n,o){void 0===t&&(t="red"),void 0===n&&(n=1.5),console.log("%c"+e,"color: "+t+"; font-size: "+n),o&&console.log(o)}var n=function(){function e(){}return e}();e.ConstUtil=n,__reflect(n.prototype,"utils.ConstUtil"),e.colorConsole=t}(utils||(utils={}));var utils;!function(e){var t=function(){function e(){}return e.getIns=function(){return this._ins||(this._ins=new e),this._ins},e.prototype.consoleMove=function(e){for(var t in e)if(e[t]instanceof Object){console.log("%c"+t+": ","color: green;font-size: 1.5em;");for(var n in e[t])console.log("%c"+n+": "+e[t][n],"color: green;font-size: 1.5em;")}else console.log("%c"+t+": "+e[t],"color: green;font-size: 1.5em;")},e}();e.Utils=t,__reflect(t.prototype,"utils.Utils")}(utils||(utils={}));var game;!function(e){var t;!function(e){e[e.left=37]="left",e[e.up=38]="up",e[e.right=39]="right",e[e.down=40]="down"}(t=e.EKeyBoard||(e.EKeyBoard={}));var n=function(n){function o(){var e=n.call(this,"GameScene")||this;return e.count=0,e}return __extends(o,n),o.prototype.onComplete=function(){n.prototype.onComplete.call(this)},o.prototype.initBtn=function(){this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_down.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_letf.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReturn,this)},o.prototype.removeBtn=function(){this.btn_up.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_down.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_letf.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_right.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMove,this),this.btn_return.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReturn,this)},o.prototype.updateView=function(){},o.prototype.init=function(){console.log("gameView初始化!"),console.log(this.gameTime),console.log(this.gridHandle),this._scoreHandle=new e.ScoreHandle(this.score)},o.prototype.startFrom=function(e){e.grid&&this.gridHandle.initBoard(e.grid),this._scoreHandle.setScore(e.score)},o.prototype.moveTiles=function(e){var t=this,n=this;return new Promise(function(o,r){var i=[];i.push(t.gridHandle.moveTiles(e)),Promise.all(i).then(function(){n.activeBtn(),n.activeKeyboard(),o()})["catch"](function(e){r(e)})})},o.prototype.onMove=function(t){var n=new e.ActionCommand(this.bg,function(){return new Promise(function(e,t){console.log("命令一"),e()})});n.actionType=e.EActionType.move;var o=t.currentTarget;switch(o.label){case"上":n.actionData=e.EMoveDirection.up;break;case"下":n.actionData=e.EMoveDirection.down;break;case"左":n.actionData=e.EMoveDirection.left;break;case"右":n.actionData=e.EMoveDirection.right}this.dispatchEventWith(customEvent.ViewEvent.EVENT_MOVE_EVENT,!1,n),this.disabledBtn()},o.prototype.onReturn=function(){this.dispatchEventWith(customEvent.ViewEvent.EVENT_RETURN_EVENT)},o.prototype.startGame=function(e){return this.activeKeyboard(),this.addTile(e)},o.prototype.addTile=function(e){var t=this;return new Promise(function(n,o){t.gridHandle.addTile(e.x,e.y,e.value),n()})},o.prototype.overGame=function(){var t=this,n=new e.ActionCommand(this,function(){return new Promise(function(e,t){console.log("游戏结束")})});return n.actionType=e.EActionType.over,new Promise(function(e,o){var r=[];Promise.all(r).then(function(){t.dispatchEventWith(customEvent.ViewEvent.EVENT_OVER_EVENT,!1,n)})})},o.prototype.addScore=function(e){return this._scoreHandle.addScore(e)},o.prototype.activeBtn=function(){this.btn_up.enabled=!0,this.btn_down.enabled=!0,this.btn_letf.enabled=!0,this.btn_right.enabled=!0},o.prototype.disabledBtn=function(){this.btn_up.enabled=!1,this.btn_down.enabled=!1,this.btn_letf.enabled=!1,this.btn_right.enabled=!1},o.prototype.activeKeyboard=function(){},o.prototype.disabledKeyboard=function(){this.count=0,window.removeEventListener("keydown",this.keyDown)},o.prototype.test=function(e){console.log("click"),this.disabledKeyboard()},o.prototype.keyDown=function(n){console.log(this.count++);var o=n.keyCode,r=new e.ActionCommand(this.bg,function(){return new Promise(function(e,t){console.log("命令一"),e()})});switch(r.actionType=e.EActionType.move,o){case t.left:r.actionData=e.EMoveDirection.left;break;case t.up:r.actionData=e.EMoveDirection.up;break;case t.right:r.actionData=e.EMoveDirection.right;break;case t.down:r.actionData=e.EMoveDirection.down}this.dispatchEventWith(customEvent.ViewEvent.EVENT_MOVE_EVENT,!1,r),this.disabledKeyboard()},o.prototype.finishGameBegin=function(e){},o.prototype.dealloc=function(){this.removeBtn(),n.prototype.dealloc.call(this)},o}(base.BaseScene);e.GameView=n,__reflect(n.prototype,"game.GameView")}(game||(game={}));var game;!function(e){var t=function(e){function t(){return e.call(this,"StartScene")||this}return __extends(t,e),t.prototype.initBtn=function(){this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},t.prototype.init=function(){},t.prototype.startGame=function(){this.dispatchEventWith(customEvent.ViewEvent.EVENT_GAME_START)},t}(base.BaseScene);e.StartScene=t,__reflect(t.prototype,"game.StartScene")}(game||(game={}));var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function r(e){t.call(o,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(o))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)
},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(o,generateJSON.paths[e])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(o,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var algorithm;!function(e){var t;!function(e){e[e.first=0]="first",e[e.second=1]="second"}(t||(t={})),e.CAnimalCount=10,e.CAnimalType=3;var n=function(){function t(){this._par=[],this._rank=[],this._elements=[],this._errorCount=0,this._root=[],this._nodes=[]}return t.prototype.setElement=function(e,t,n){var o={type:e,x:t,y:n};this._elements.push(o)},t.prototype.sort=function(){this._errorCount=0,this._root=[],this.init(e.CAnimalType*e.CAnimalCount);for(var t=0,n=this._elements;t<n.length;t++){var o=n[t],r=[o.x-1,o.y-1],i=r[0],a=r[1];if(0>i||0>a||i>=e.CAnimalCount||a>=e.CAnimalCount)this._errorCount++,console.log(o);else if(1==o.type){if(this.same(i,a+e.CAnimalCount)||this.same(i,a+2*e.CAnimalCount)){this._errorCount++,console.log(o);continue}this.merge(i,a),this.merge(i+e.CAnimalCount,a+e.CAnimalCount),this.merge(i+2*e.CAnimalCount,a+2*e.CAnimalCount)}else if(2==o.type){if(this.same(i,a)||this.same(i,a+2*e.CAnimalCount)){this._errorCount++,console.log(o);continue}this.merge(i,a+e.CAnimalCount),this.merge(i+e.CAnimalCount,a+2*e.CAnimalCount),this.merge(i+2*e.CAnimalCount,a)}}console.log(this._par,this._rank),console.log(this._errorCount),console.log(this._root)},t.prototype.init=function(e){for(var t=0;e>t;t++){this._par.push(t),this._rank.push(0);var n={value:t,child:null};this._root.push(n),this._nodes.push(n)}},t.prototype.find=function(e){return this._par[e]==e?e:this.find(this._par[e])},t.prototype.merge=function(e,t){if(e=this.find(e),t=this.find(t),e!=t)if(this._rank[e]<this._rank[t]){this._par[e]=this._par[t];var n=this.findNode(t),o=this.findNode(e);n.child=o;var r=this._root.indexOf(o);this._root.splice(r,1)}else{this._par[t]=this._par[e],this._rank[e]==this._rank[t]&&this._rank[e]++;var n=this.findNode(e),o=this.findNode(t);n.child=o;var r=this._root.indexOf(o);this._root.splice(r,1)}},t.prototype.findNode=function(e){var t;return this._nodes.forEach(function(n){n.value==e&&(t=n)}),t},t.prototype.publish=function(){console.log(this._par),console.log(this._rank)},t.prototype.same=function(e,t){return this.find(e)==this.find(t)},t}();e.Bing=n,__reflect(n.prototype,"algorithm.Bing")}(algorithm||(algorithm={}));var component;!function(e){var t="GameTime: ",n=function(e){function n(){var t=e.call(this)||this;return t.data={time:0},t.skinName=GameTimerSkin,t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.remove,t),t}return __extends(n,e),n.prototype.addCurrentTime=function(){this.data.time+=1,this.gameTime.text=t+this.data.time+"s"},n.prototype.init=function(){console.log(this.gameTime)},n.prototype.createChildren=function(){manager.TimerCtrl.getInstance().createTimer(this,1e3,0,this.addCurrentTime,"gameTime")},n.prototype.remove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.remove,this),manager.TimerCtrl.getInstance().killTimer(this,"gameTime")},n}(base.BaseComponent);e.GameTimeHandle=n,__reflect(n.prototype,"component.GameTimeHandle")}(component||(component={}));var game;!function(e){e.SIZE=5;var t=function(){function t(e){var t=JSON.parse(localStorage.getItem("configOf2048"));console.log("获取配置",t),e?this.fromState(e):this.empty()}return t.prototype.getGrid=function(){return this.cells},t.prototype.addRandomTile=function(){var e=this.getVacancyPositions();if(e.length){var t=e[Math.floor(Math.random()*e.length)],n=Math.random()<.9?1:2;this.insertTile(t.x,t.y,n);var o={x:t.x,y:t.y,value:n};return o}return console.log("无空位可添加棋子"),null},t.prototype.getVacancyPositions=function(){for(var t=[],n=0;n<e.C_BOARD_MAX;n++)for(var o=0;o<e.C_BOARD_MAX;o++)1==this.isVacancy(n,o)&&t.push(new egret.Point(n,o));return t},t.prototype.isVacancy=function(e,t){return null==this.cells[e][t]||0==this.cells[e][t]},t.prototype.fromState=function(t){for(var n=[],o=0;o<e.SIZE;o++)for(var r=n[o]=[],i=0;i<e.SIZE;i++){var a=t[o][i];r.push(a?a:null)}return this.cells=n,console.log("生成的配置:\n",n),n},t.prototype.empty=function(){for(var t=[],n=0;n<e.SIZE;n++)for(var o=t[n]=[],r=0;r<e.SIZE;r++)o.push(null);return this.cells=t,t},t.prototype.cellContent=function(e){return this.withinBounds(e)?this.cells[e.x][e.y]:null},t.prototype.withinBounds=function(t){return t.x>=0&&t.x<e.SIZE&&t.y>=0&&t.y<e.SIZE},t.prototype.cellAvailable=function(e){return!this.cellOccupied(e)},t.prototype.cellOccupied=function(e){return!!this.cellContent(e)},t.prototype.insertTile=function(e,t,n){this.cells[e][t]=n},t.prototype.changeTile=function(e){var t=this.cells[e.origin.x][e.origin.y],n=e.add?t+1:t;this.insertTile(e.origin.x,e.origin.y,null),this.insertTile(e.goal.x,e.goal.y,n)},t.prototype.removeTile=function(e,t){console.log("移除"+(e+","+t)),this.cells[e][t]=null},t.prototype.moveTile=function(e,t){var n=this.cells[e.x][e.y];this.cells[e.x][e.y]=null,this.cells[t.x][t.y]=n},t.prototype.checkGameOver=function(){if(0!=this.getVacancyPositions().length)return!1;for(var t=0;t<e.C_BOARD_MAX;t++)for(var n=0;n<e.C_BOARD_MAX-1;n++)if(this.cells[t][n]==this.cells[t][n+1])return!1;for(var t=0;t<e.C_BOARD_MAX;t++)for(var n=0;n<e.C_BOARD_MAX-1;n++)if(this.cells[n][t]==this.cells[n+1][t])return!1;return!0},t}();e.Grid=t,__reflect(t.prototype,"game.Grid")}(game||(game={}));var component;!function(e){e.PIECE_WIDTH=111,e.TILE_LENGTH=5,e.SIZE=5;var t=function(e){function t(){var t=e.call(this)||this;return t.tiles={},t}return __extends(t,e),t.prototype.init=function(){},t.prototype.addTile=function(e,t,n){var o=new game.Tile(e,t,n);this.tiles[""+e+t]=o,this.addChild(o)},t.prototype.initBoard=function(e){var t=this;e.forEach(function(e,n){e.forEach(function(e,o){t.addTile(n,o,e)})})},t.prototype.moveTiles=function(e){var t=this,n=this;return new Promise(function(o,r){var i=[];e.forEach(function(e){var o=t.tiles[""+e.origin.x+e.origin.y];o||console.error("找不到棋子:",e.origin),delete n.tiles[""+e.origin.x+e.origin.y],e.merge||(n.tiles[""+e.goal.x+e.goal.y]=o),i.push(o.moveTo(e).then(function(){if(e.merge){n.removeChild(o);var r=t.tiles[""+e.goal.x+e.goal.y];r?r.gameView=r.value+1:console.error("找不到目标棋子:",e.goal)}}))}),Promise.all(i).then(function(){o()})["catch"](function(e){console.error("棋子移动出现问题:",e)})})},t.prototype.reset=function(){},t}(base.BaseComponent);e.GridHandle=t,__reflect(t.prototype,"component.GridHandle")}(component||(component={}));var game;!function(e){var t=300,n=function(){function e(e){this._currentScore=0,this._goalScore=0,this._perAdd=0,this._addResolve=null,this._label=e}return e.prototype.addScore=function(e){var n=this,o=this;return this._goalScore=this._currentScore+e,0===e?Promise.resolve():new Promise(function(r,i){o._addResolve=r;var a=Math.ceil(t/60);o._perAdd=Math.ceil(e/a);var s=new egret.Timer(60,a);s.addEventListener(egret.TimerEvent.TIMER,n.perAdd,n),s.addEventListener(egret.TimerEvent.TIMER_COMPLETE,n.addComplete,n),s.start()})},e.prototype.setScore=function(e){this._currentScore=e,this._label.text=this._currentScore+""},e.prototype.perAdd=function(e){e.target.currentCount;this._currentScore+this._perAdd<this._goalScore?this.setScore(this._currentScore+this._perAdd):this.setScore(this._goalScore)},e.prototype.addComplete=function(){this._addResolve&&(this._addResolve(),this._addResolve=null,this._perAdd=0)},e}();e.ScoreHandle=n,__reflect(n.prototype,"game.ScoreHandle")}(game||(game={}));var game;!function(e){var t;!function(e){e[e.one=1]="one",e[e.two=2]="two",e[e.three=3]="three",e[e.four=4]="four",e[e.five=5]="five",e[e.six=6]="six",e[e.seven=7]="seven",e[e.eight=8]="eight",e[e.nine=9]="nine",e[e.ten=10]="ten",e[e.eleven=11]="eleven"}(t=e.GameValue||(e.GameValue={})),e.PIECE_WIDTH=111,e.C_MOVE_TIME=300;var n=function(t){function n(n,o,r){var i=t.call(this)||this;return i.m_states=0,i.mergedFrom=null,i.m_readyToRemove=!1,i.point=new egret.Point(n,o),i.updatePosition(),i._backImage=new eui.Image,i._backImage.width=i._backImage.height=e.PIECE_WIDTH,i.addChild(i._backImage),i.gameView=r,i}return __extends(n,t),Object.defineProperty(n.prototype,"gameView",{set:function(e){this._gameValue=e,this._backImage.source=RES.getRes("tile_"+e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._gameValue},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"point",{set:function(e){this.cachePoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Point",{get:function(){return this.cachePoint},enumerable:!0,configurable:!0}),n.prototype.savePosition=function(){this.mergedFrom=null,this.previousPosition=this.cachePoint},n.prototype.updatePosition=function(){this.x=this.Point.y*e.PIECE_WIDTH,this.y=this.Point.x*e.PIECE_WIDTH},n.prototype.moveTo=function(t){var n=this;return new Promise(function(o,r){egret.Tween.get(n).to({x:t.goal.y*e.PIECE_WIDTH,y:t.goal.x*e.PIECE_WIDTH},e.C_MOVE_TIME,egret.Ease.quadIn).call(function(){1==t.merge&&(n.visible=!1),n.point=new egret.Point(t.goal.x,t.goal.y),n.updatePosition(),o()})})},n}(base.BaseComponent);e.Tile=n,__reflect(n.prototype,"game.Tile")}(game||(game={}));var game;!function(e){var t=function(){function e(e){this.m_myTiles=[]}return e.prototype.getPositionTile=function(e){this.m_myTiles.forEach(function(t,n){return e==t.Point?{tile:t,index:n}:void 0})},e.prototype.push=function(e){this.m_myTiles.push(e),this.m_main.addChild(e)},e.prototype.remove=function(e){var t=this.getPositionTile(e).tile;this.m_main.removeChild(t.tile),this.m_myTiles.splice(t.index)},e}();e.Tiles=t,__reflect(t.prototype,"game.Tiles")}(game||(game={}));